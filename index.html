<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HMD - BAC 2026</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Appwrite SDK -->
    <script src="https://cdn.jsdelivr.net/npm/appwrite@14.0.1"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --secondary: #ec4899;
            --accent: #06b6d4;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #0f172a;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
        }
        
        body.dark-mode {
            --gray-50: #1e293b;
            --gray-100: #334155;
            --gray-200: #475569;
            --gray-300: #64748b;
            --gray-600: #cbd5e1;
            --gray-700: #e2e8f0;
            --gray-800: #f1f5f9;
            --gray-900: #f8fafc;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(to bottom, #0f172a, #1e293b);
            min-height: 100vh;
            color: var(--gray-900);
            position: relative;
            transition: all 0.3s ease;
        }
        
        body.dark-mode {
            background: linear-gradient(to bottom, #000000, #0f172a);
        }

        /* ===== LOGIN PANEL STYLES ===== */
        .login-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        .login-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .login-container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 32px;
            padding: 48px 40px;
            max-width: 450px;
            width: 90%;
            box-shadow: 
                0 0 0 1px rgba(255, 255, 255, 0.1),
                0 40px 100px -20px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        body.dark-mode .login-container {
            background: rgba(30, 41, 59, 0.98);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .login-logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 20px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }

        .login-title {
            font-size: 1.75rem;
            font-weight: 800;
            background: linear-gradient(135deg, #6366f1 0%, #ec4899 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .login-subtitle {
            color: var(--gray-600);
            font-size: 0.95rem;
        }

        body.dark-mode .login-subtitle {
            color: var(--gray-300);
        }

        .login-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            background: var(--gray-100);
            padding: 6px;
            border-radius: 12px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--gray-600);
        }

        .tab-btn.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .tab-btn.active {
            background: var(--gray-700);
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            position: relative;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--gray-700);
            font-size: 0.9rem;
        }

        body.dark-mode .form-label {
            color: var(--gray-300);
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--gray-50);
            color: var(--gray-900);
        }

        body.dark-mode .form-input {
            background: var(--gray-800);
            border-color: var(--gray-600);
            color: var(--gray-100);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        .password-toggle {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray-400);
            cursor: pointer;
            font-size: 1.2rem;
        }

        .login-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }

        .login-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* User Info Display */
        .user-info {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 12px 20px;
            border-radius: 50px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: none;
            align-items: center;
            gap: 12px;
            z-index: 1000;
        }

        body.dark-mode .user-info {
            background: rgba(30, 41, 59, 0.95);
        }

        .user-info.show {
            display: flex;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.2rem;
        }

        .user-name {
            font-weight: 600;
            color: var(--gray-900);
        }

        body.dark-mode .user-name {
            color: var(--gray-100);
        }

        .logout-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #dc2626;
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.9), rgba(236, 72, 153, 0.9));
            backdrop-filter: blur(10px);
            padding: 24px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            inset: 0;
            background: url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="p" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="1" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23p)"/></svg>');
            opacity: 0.3;
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .logo {
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 20px;
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .title {
            font-size: 2.5rem;
            font-weight: 900;
            color: white;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            margin-bottom: 8px;
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.95);
            font-size: 1.1rem;
            font-weight: 500;
        }

        .theme-toggle {
            position: absolute;
            top: 24px;
            right: 24px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.3rem;
            backdrop-filter: blur(10px);
        }

        .theme-toggle:hover {
            transform: scale(1.1) rotate(15deg);
            background: rgba(255, 255, 255, 0.3);
        }

        /* Tabs */
        .tabs {
            display: flex;
            justify-content: center;
            gap: 16px;
            padding: 32px 24px;
            background: var(--gray-50);
            flex-wrap: wrap;
        }

        body.dark-mode .tabs {
            background: var(--gray-900);
        }

        .tab {
            padding: 14px 32px;
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: 16px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1.05rem;
            transition: all 0.3s ease;
            color: var(--gray-700);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        body.dark-mode .tab {
            background: var(--gray-800);
            border-color: var(--gray-700);
            color: var(--gray-200);
        }

        .tab:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(99, 102, 241, 0.2);
        }

        .tab.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-color: transparent;
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4);
        }

        /* Content */
        .content {
            max-width: 900px;
            margin: 40px auto;
            padding: 0 24px;
        }

        .panel {
            display: none;
            background: white;
            padding: 40px;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.5s ease;
        }

        body.dark-mode .panel {
            background: var(--gray-800);
        }

        .panel.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .panel-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .panel-icon {
            font-size: 3.5rem;
            margin-bottom: 16px;
        }

        .panel-title {
            font-size: 2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .panel-subtitle {
            color: var(--gray-600);
            font-size: 1rem;
        }

        body.dark-mode .panel-subtitle {
            color: var(--gray-400);
        }

        /* Form Controls */
        .form-row {
            display: grid;
            gap: 24px;
            margin-bottom: 24px;
        }

        .form-row.cols-2 {
            grid-template-columns: 2fr 1fr;
        }

        .form-row.cols-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .form-row.cols-4 {
            grid-template-columns: repeat(4, 1fr);
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--gray-700);
        }

        body.dark-mode label {
            color: var(--gray-300);
        }

        select, input[type="number"], input[type="text"] {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--gray-50);
            color: var(--gray-900);
        }

        body.dark-mode select,
        body.dark-mode input[type="number"],
        body.dark-mode input[type="text"] {
            background: var(--gray-700);
            border-color: var(--gray-600);
            color: var(--gray-100);
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        /* Table */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 24px 0;
        }

        thead {
            background: linear-gradient(135deg, var(--primary-light), var(--secondary));
        }

        th {
            padding: 16px;
            text-align: center;
            color: white;
            font-weight: 700;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        tbody tr {
            border-bottom: 1px solid var(--gray-200);
            transition: all 0.3s ease;
        }

        body.dark-mode tbody tr {
            border-bottom-color: var(--gray-700);
        }

        tbody tr:hover {
            background: var(--gray-50);
        }

        body.dark-mode tbody tr:hover {
            background: var(--gray-700);
        }

        td {
            padding: 16px;
            text-align: center;
            color: var(--gray-700);
        }

        body.dark-mode td {
            color: var(--gray-300);
        }

        td input {
            text-align: center;
        }

        /* Buttons */
        .btn-group {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 32px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 32px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }

        .btn-secondary {
            background: var(--gray-200);
            color: var(--gray-700);
        }

        body.dark-mode .btn-secondary {
            background: var(--gray-700);
            color: var(--gray-200);
        }

        .btn-secondary:hover {
            background: var(--gray-300);
        }

        body.dark-mode .btn-secondary:hover {
            background: var(--gray-600);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        /* Result Box */
        .result-box {
            margin-top: 32px;
            padding: 32px;
            border-radius: 20px;
            text-align: center;
            display: none;
            animation: scaleIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .result-box.show {
            display: block;
        }

        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .result-box.excellent {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
        }

        .result-box.good {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            color: white;
        }

        .result-box.average {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .result-box.weak {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .result-icon {
            font-size: 4rem;
            margin-bottom: 16px;
            display: block;
        }

        .result-text {
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: 12px;
        }

        .result-message {
            font-size: 1.2rem;
            font-weight: 600;
            opacity: 0.95;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 32px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(236, 72, 153, 0.1));
            padding: 24px;
            border-radius: 16px;
            text-align: center;
            border: 2px solid rgba(99, 102, 241, 0.2);
        }

        body.dark-mode .stat-card {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(236, 72, 153, 0.2));
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--gray-600);
            margin-bottom: 8px;
            font-weight: 600;
        }

        body.dark-mode .stat-label {
            color: var(--gray-400);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Success Message */
        .success-message {
            position: fixed;
            top: 100px;
            right: 50%;
            transform: translateX(50%) translateY(-200%);
            background: linear-gradient(135deg, var(--success), #16a34a);
            color: white;
            padding: 16px 32px;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(34, 197, 94, 0.4);
            font-weight: 700;
            z-index: 10000;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .success-message.show {
            transform: translateX(50%) translateY(0);
        }

        /* Checkbox */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 20px 0;
        }

        input[type="checkbox"] {
            width: 24px;
            height: 24px;
            cursor: pointer;
            accent-color: var(--primary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .title {
                font-size: 2rem;
            }

            .form-row.cols-2,
            .form-row.cols-3,
            .form-row.cols-4 {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: 10px 6px;
            }

            td input {
                padding: 8px;
            }

            .panel {
                padding: 24px;
            }

            .user-info {
                top: 10px;
                left: 10px;
                padding: 8px 12px;
            }

            .user-avatar {
                width: 32px;
                height: 32px;
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            .tabs {
                flex-direction: column;
                gap: 12px;
            }

            .tab {
                width: 100%;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            table {
                display: block;
                overflow-x: auto;
            }

            thead {
                display: none;
            }

            tbody, tr, td {
                display: block;
            }

            tr {
                margin-bottom: 16px;
                border: 2px solid var(--gray-200);
                border-radius: 12px;
                padding: 16px;
            }

            td {
                padding: 8px 0;
                text-align: right;
                position: relative;
                padding-right: 50%;
            }

            td::before {
                content: attr(data-label);
                position: absolute;
                right: 0;
                font-weight: 700;
                color: var(--gray-900);
            }

            body.dark-mode td::before {
                color: var(--gray-100);
            }

            td input {
                text-align: right;
            }
        }
    </style>
</head>
<body>
    <!-- User Info Display -->
    <div class="user-info" id="userInfo">
        <div class="user-avatar" id="userAvatar">H</div>
        <span class="user-name" id="userName">Ù…Ø³ØªØ®Ø¯Ù…</span>
        <button class="logout-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>

    <!-- Login Overlay -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo">ğŸ“</div>
                <h2 class="login-title">HMD - BAC 2026</h2>
                <p class="login-subtitle">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù„Ø§Øª</p>
            </div>

            <!-- Login/Register Tabs -->
            <div class="login-tabs">
                <button class="tab-btn active" onclick="switchAuthTab('login')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                <button class="tab-btn" onclick="switchAuthTab('register')">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
            </div>

            <!-- Login Form -->
            <div id="loginForm" class="tab-content active">
                <form class="login-form" onsubmit="handleLogin(event)">
                    <div class="error-message" id="loginError"></div>
                    
                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" class="form-input" id="loginEmail" required 
                               placeholder="example@email.com">
                    </div>

                    <div class="form-group">
                        <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" class="form-input" id="loginPassword" required 
                               placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    </div>

                    <button type="submit" class="login-btn" id="loginBtn">
                        <i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                    </button>
                </form>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="tab-content">
                <form class="login-form" onsubmit="handleRegister(event)">
                    <div class="error-message" id="registerError"></div>
                    
                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                        <input type="text" class="form-input" id="registerName" required 
                               placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" class="form-input" id="registerEmail" required 
                               placeholder="example@email.com">
                    </div>

                    <div class="form-group">
                        <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" class="form-input" id="registerPassword" required 
                               placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" minlength="8">
                    </div>

                    <button type="submit" class="login-btn" id="registerBtn">
                        <i class="fas fa-user-plus"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Success Message -->
    <div class="success-message" id="successMsg"></div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">ğŸ“</div>
            <h1 class="title">HMD - BAC 2026</h1>
            <p class="subtitle">Ù†Ø¸Ø§Ù… Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù„Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</p>
        </div>
        <button class="theme-toggle" onclick="toggleTheme()">
            <i class="fas fa-moon"></i>
        </button>
    </header>

    <!-- Navigation Tabs -->
    <div class="tabs">
        <div class="tab active" onclick="switchTab(0)">
            <i class="fas fa-calculator"></i> Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù„
        </div>
        <div class="tab" onclick="switchTab(1)">
            <i class="fas fa-calendar-alt"></i> Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ
        </div>
        <div class="tab" onclick="switchTab(2)">
            <i class="fas fa-bullseye"></i> Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
        </div>
        <div class="tab" onclick="switchTab(3)">
            <i class="fas fa-graduation-cap"></i> Ù…Ø¹Ø¯Ù„ BAC
        </div>
    </div>

    <!-- Main Content -->
    <div class="content">
        <!-- Panel 1: GPA Calculator -->
        <div class="panel active" id="panel-0">
            <div class="panel-header">
                <div class="panel-icon">ğŸ“Š</div>
                <h2 class="panel-title">Ø­Ø³Ø§Ø¨ Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØµÙ„</h2>
                <p class="panel-subtitle">Ø§Ø­Ø³Ø¨ Ù…Ø¹Ø¯Ù„Ùƒ Ø§Ù„ÙØµÙ„ÙŠ Ø¨Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ©</p>
            </div>

            <div class="form-row cols-2">
                <div>
                    <label>Ø§Ø®ØªØ± Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©:</label>
                    <select id="year-sel" onchange="loadGPATable()">
                        <option value="1">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ</option>
                        <option value="2">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø«Ø§Ù†ÙˆÙŠ</option>
                        <option value="3">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© Ø«Ø§Ù†ÙˆÙŠ</option>
                    </select>
                </div>
                <div>
                    <label>Ø§Ø®ØªØ± Ø§Ù„Ø´Ø¹Ø¨Ø©:</label>
                    <select id="stream-sel" onchange="loadGPATable()"></select>
                </div>
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="tam-chk" onchange="loadGPATable()">
                <label for="tam-chk">Ø£Ø¯Ø±Ø³ Ø§Ù„Ø£Ù…Ø§Ø²ÙŠØºÙŠØ©</label>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                        <th>ØªÙ‚ÙˆÙŠÙ…</th>
                        <th>ÙØ±Ø¶ 1</th>
                        <th>ÙØ±Ø¶ 2</th>
                        <th>Ø§Ø®ØªØ¨Ø§Ø±</th>
                        <th>Ø§Ù„Ù…Ø¹Ø§Ù…Ù„</th>
                        <th>Ø§Ù„Ù…Ø¹Ø¯Ù„</th>
                    </tr>
                </thead>
                <tbody id="gpa-body"></tbody>
            </table>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="calcGPA()">
                    <i class="fas fa-calculator"></i> Ø§Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù„
                </button>
                <button class="btn btn-secondary" onclick="saveData()">
                    <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
                <button class="btn btn-secondary" onclick="captureResult()">
                    <i class="fas fa-camera"></i> Ø­ÙØ¸ ÙƒØµÙˆØ±Ø©
                </button>
                <button class="btn btn-danger" onclick="resetForm()">
                    <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                </button>
            </div>

            <div class="result-box" id="final-res">
                <span class="result-icon">ğŸ¯</span>
                <div class="result-text">Ù…Ø¹Ø¯Ù„Ùƒ Ù‡Ùˆ: 0.00</div>
                <div class="result-message">Ø£Ø¯Ø®Ù„ Ø¹Ù„Ø§Ù…Ø§ØªÙƒ ÙˆØ§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù„</div>
            </div>
        </div>

        <!-- Panel 2: Yearly Average -->
        <div class="panel" id="panel-1">
            <div class="panel-header">
                <div class="panel-icon">ğŸ“…</div>
                <h2 class="panel-title">Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ</h2>
                <p class="panel-subtitle">Ø§Ø­Ø³Ø¨ Ù…Ø¹Ø¯Ù„Ùƒ Ø§Ù„Ø³Ù†ÙˆÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙØµÙˆÙ„ Ø§Ù„Ø«Ù„Ø§Ø«Ø©</p>
            </div>

            <div class="form-row cols-3">
                <div>
                    <label>Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„:</label>
                    <input type="number" id="t1-avg" min="0" max="20" step="0.01" placeholder="0.00">
                </div>
                <div>
                    <label>Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ:</label>
                    <input type="number" id="t2-avg" min="0" max="20" step="0.01" placeholder="0.00">
                </div>
                <div>
                    <label>Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù„Ø«:</label>
                    <input type="number" id="t3-avg" min="0" max="20" step="0.01" placeholder="0.00">
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="calcYearly()">
                    <i class="fas fa-calculator"></i> Ø§Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ
                </button>
            </div>

            <div class="result-box" id="yearly-result">
                <span class="result-icon">ğŸ“Š</span>
                <div class="result-text">Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ: 0.00</div>
                <div class="result-message">Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø¯Ù„Ø§Øª Ø§Ù„ÙØµÙˆÙ„ Ø§Ù„Ø«Ù„Ø§Ø«Ø©</div>
            </div>
        </div>

        <!-- Panel 3: Needed Mark -->
        <div class="panel" id="panel-2">
            <div class="panel-header">
                <div class="panel-icon">ğŸ¯</div>
                <h2 class="panel-title">Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</h2>
                <p class="panel-subtitle">Ø§Ø¹Ø±Ù Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬Ù‡Ø§ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</p>
            </div>

            <div class="form-row cols-4">
                <div>
                    <label>Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</label>
                    <input type="number" id="target-avg" min="0" max="20" step="0.01" placeholder="0.00">
                </div>
                <div>
                    <label>Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªÙ‚ÙˆÙŠÙ…:</label>
                    <input type="number" id="eval-mark" min="0" max="20" step="0.25" placeholder="0.00">
                </div>
                <div>
                    <label>Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ÙØ±Ø¶ 1:</label>
                    <input type="number" id="test1-mark" min="0" max="20" step="0.25" placeholder="0.00">
                </div>
                <div>
                    <label>Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ÙØ±Ø¶ 2:</label>
                    <input type="number" id="test2-mark" min="0" max="20" step="0.25" placeholder="0.00">
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="calcNeeded()">
                    <i class="fas fa-bullseye"></i> Ø§Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                </button>
            </div>

            <div class="result-box" id="needed-result">
                <span class="result-icon">ğŸ¯</span>
                <div class="result-text">Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: 0.00</div>
                <div class="result-message">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</div>
            </div>
        </div>

        <!-- Panel 4: BAC Calculator -->
        <div class="panel" id="panel-3">
            <div class="panel-header">
                <div class="panel-icon">ğŸ“</div>
                <h2 class="panel-title">Ø­Ø³Ø§Ø¨ Ù…Ø¹Ø¯Ù„ Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø¨ÙƒØ§Ù„ÙˆØ±ÙŠØ§</h2>
                <p class="panel-subtitle">Ø§Ø­Ø³Ø¨ Ù…Ø¹Ø¯Ù„Ùƒ ÙÙŠ Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ø¨ÙƒØ§Ù„ÙˆØ±ÙŠØ§</p>
            </div>

            <div class="form-row cols-2">
                <div>
                    <label>Ø§Ø®ØªØ± Ø§Ù„Ø´Ø¹Ø¨Ø©:</label>
                    <select id="bac-strm" onchange="loadBacTable()"></select>
                </div>
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="tam-bac" onchange="loadBacTable()">
                <label for="tam-bac">Ø£Ø¯Ø±Ø³ Ø§Ù„Ø£Ù…Ø§Ø²ÙŠØºÙŠØ©</label>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                        <th>Ø§Ù„Ø¹Ù„Ø§Ù…Ø©</th>
                        <th>Ø§Ù„Ù…Ø¹Ø§Ù…Ù„</th>
                        <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                    </tr>
                </thead>
                <tbody id="bac-body"></tbody>
            </table>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="calcBac()">
                    <i class="fas fa-calculator"></i> Ø§Ø­Ø³Ø¨ Ù…Ø¹Ø¯Ù„ BAC
                </button>
            </div>

            <div class="stats-grid" id="bac-stats">
                <div class="stat-card">
                    <div class="stat-label">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·</div>
                    <div class="stat-value" id="res-pts">0.00</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</div>
                    <div class="stat-value" id="res-coef">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</div>
                    <div class="stat-value" id="res-avg">0.00</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== Appwrite Configuration ==========
        const { Client, Account, Databases, ID, Query } = Appwrite;

        const client = new Client()
            .setEndpoint('https://fra.cloud.appwrite.io/v1')
            .setProject('6988df30002f5dcb4f7d');

        const account = new Account(client);
        const databases = new Databases(client);

        const DATABASE_ID = '6988df7f0000d935ff6b';
        const STUDENTS_COLLECTION_ID = 'students';
        const GRADES_COLLECTION_ID = 'grades';

        let currentUser = null;

        // ========== Authentication Functions ==========
        async function checkAuth() {
            try {
                const user = await account.get();
                currentUser = user;
                hideLoginPanel();
                await loadUserData();
            } catch (error) {
                showLoginPanel();
            }
        }

        function switchAuthTab(tab) {
            const tabs = document.querySelectorAll('.tab-btn');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(t => t.classList.remove('active'));
            contents.forEach(c => c.classList.remove('active'));
            
            if (tab === 'login') {
                tabs[0].classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                tabs[1].classList.add('active');
                document.getElementById('registerForm').classList.add('active');
            }
        }

        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const loginBtn = document.getElementById('loginBtn');
            const errorEl = document.getElementById('loginError');
            
            try {
                loginBtn.disabled = true;
                loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...';
                errorEl.classList.remove('show');
                
                await account.createEmailPasswordSession(email, password);
                currentUser = await account.get();
                
                hideLoginPanel();
                await loadUserData();
                showSuccessMessage('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰');
                
            } catch (error) {
                console.error('Login error:', error);
                let errorMessage = 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                
                if (error.code === 401) {
                    errorMessage = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
                } else if (error.code === 429) {
                    errorMessage = 'Ø¹Ø¯Ø¯ ÙƒØ¨ÙŠØ± Ù…Ù† Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§ØªØŒ Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹';
                } else if (error.message) {
                    errorMessage = error.message;
                } else if (error.type === 'network') {
                    errorMessage = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª';
                }
                
                errorEl.textContent = 'âš ï¸ ' + errorMessage;
                errorEl.classList.add('show');
            } finally {
                loginBtn.disabled = false;
                loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
            }
        }

        async function handleRegister(event) {
            event.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const registerBtn = document.getElementById('registerBtn');
            const errorEl = document.getElementById('registerError');
            
            try {
                registerBtn.disabled = true;
                registerBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨...';
                errorEl.classList.remove('show');
                
                // Create account
                const user = await account.create(ID.unique(), email, password, name);
                
                // Create session (login)
                await account.createEmailPasswordSession(email, password);
                currentUser = await account.get();
                
                // Create student record
                await databases.createDocument(
                    DATABASE_ID,
                    STUDENTS_COLLECTION_ID,
                    ID.unique(),
                    {
                        userId: currentUser.$id,
                        fullName: name,
                        email: email,
                        avatar: name.charAt(0).toUpperCase()
                    }
                );
                
                hideLoginPanel();
                await loadUserData();
                showSuccessMessage('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰');
                
            } catch (error) {
                console.error('Register error:', error);
                let errorMessage = 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                
                if (error.code === 409) {
                    errorMessage = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…ÙØ³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„';
                } else if (error.type === 'user_invalid_credentials') {
                    errorMessage = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹ (8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)';
                } else if (error.message) {
                    errorMessage = error.message;
                } else if (error.type === 'network') {
                    errorMessage = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª';
                }
                
                errorEl.textContent = 'âš ï¸ ' + errorMessage;
                errorEl.classList.add('show');
            } finally {
                registerBtn.disabled = false;
                registerBtn.innerHTML = '<i class="fas fa-user-plus"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨';
            }
        }

        async function logout() {
            try {
                await account.deleteSession('current');
                currentUser = null;
                showLoginPanel();
                showSuccessMessage('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­!');
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        function showLoginPanel() {
            document.getElementById('loginOverlay').classList.remove('hidden');
            document.getElementById('userInfo').classList.remove('show');
        }

        function hideLoginPanel() {
            document.getElementById('loginOverlay').classList.add('hidden');
            document.getElementById('userInfo').classList.add('show');
        }

        async function loadUserData() {
            try {
                // Get student data
                const response = await databases.listDocuments(
                    DATABASE_ID,
                    STUDENTS_COLLECTION_ID,
                    [
                        Query.equal('userId', currentUser.$id)
                    ]
                );
                
                if (response.documents.length > 0) {
                    const student = response.documents[0];
                    document.getElementById('userName').textContent = student.fullName;
                    document.getElementById('userAvatar').textContent = student.avatar || student.fullName.charAt(0).toUpperCase();
                } else {
                    // Use data from account if no student record
                    document.getElementById('userName').textContent = currentUser.name || 'Ù…Ø³ØªØ®Ø¯Ù…';
                    document.getElementById('userAvatar').textContent = (currentUser.name || 'U').charAt(0).toUpperCase();
                }
                
                // Load saved grades if any
                await loadSavedGrades();
                
            } catch (error) {
                console.error('Error loading user data:', error);
                // Still show basic info even if database fails
                document.getElementById('userName').textContent = currentUser.name || 'Ù…Ø³ØªØ®Ø¯Ù…';
                document.getElementById('userAvatar').textContent = (currentUser.name || 'U').charAt(0).toUpperCase();
            }
        }

        async function loadSavedGrades() {
            try {
                const response = await databases.listDocuments(
                    DATABASE_ID,
                    GRADES_COLLECTION_ID,
                    [
                        Query.equal('userId', currentUser.$id)
                    ]
                );
                
                // You can implement auto-loading of saved grades here
                console.log('Saved grades:', response.documents);
                
            } catch (error) {
                console.error('Error loading saved grades:', error);
            }
        }

        // Initialize authentication check on page load
        window.addEventListener('DOMContentLoaded', () => {
            checkAuth();
        });

        // ========== Original Calculator Functions ==========
        const db = {
            "1": {
                "Ø¹Ù„ÙˆÙ…": [["Ø±ÙŠØ§Ø¶ÙŠØ§Øª", 3], ["Ø¹Ù„ÙˆÙ… Ø·Ø¨ÙŠØ¹ÙŠØ©", 2], ["ÙÙŠØ²ÙŠØ§Ø¡", 2], ["Ø¹Ø±Ø¨ÙŠØ©", 3], ["ÙØ±Ù†Ø³ÙŠØ©", 3], ["Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©", 2], ["ØªØ§Ø±ÙŠØ® ÙˆØ¬ØºØ±Ø§ÙÙŠØ§", 2], ["ØªØ±Ø¨ÙŠØ© Ø¥Ø³Ù„Ø§Ù…ÙŠØ©", 2], ["ÙÙ„Ø³ÙØ©", 2], ["ØªØ±Ø¨ÙŠØ© Ø¨Ø¯Ù†ÙŠØ©", 1]],
                "Ø¢Ø¯Ø§Ø¨": [["Ø¹Ø±Ø¨ÙŠØ©", 4], ["ÙØ±Ù†Ø³ÙŠØ©", 3], ["Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©", 2], ["ØªØ§Ø±ÙŠØ® ÙˆØ¬ØºØ±Ø§ÙÙŠØ§", 3], ["ØªØ±Ø¨ÙŠØ© Ø¥Ø³Ù„Ø§Ù…ÙŠØ©", 2], ["ÙÙ„Ø³ÙØ©", 2], ["Ø±ÙŠØ§Ø¶ÙŠØ§Øª", 2], ["Ø¹Ù„ÙˆÙ… Ø·Ø¨ÙŠØ¹ÙŠØ©", 1], ["ØªØ±Ø¨ÙŠØ© Ø¨Ø¯Ù†ÙŠØ©", 1]],
                "Ù„ØºØ§Øª": [["Ø¹Ø±Ø¨ÙŠØ©", 3], ["ÙØ±Ù†Ø³ÙŠØ©", 4], ["Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©", 3], ["Ø¥Ø³Ø¨Ø§Ù†ÙŠØ©", 2], ["ØªØ§Ø±ÙŠØ® ÙˆØ¬ØºØ±Ø§ÙÙŠØ§", 2], ["ØªØ±Ø¨ÙŠØ© Ø¥Ø³Ù„Ø§Ù…ÙŠØ©", 2], ["ÙÙ„Ø³ÙØ©", 2], ["Ø±ÙŠØ§Ø¶ÙŠØ§Øª", 2], ["ØªØ±Ø¨ÙŠØ© Ø¨Ø¯Ù†ÙŠØ©", 1]]
            },
            "2": {
                "Ø¹Ù„ÙˆÙ…": [["Ø±ÙŠØ§Ø¶ÙŠØ§Øª", 4], ["Ø¹Ù„ÙˆÙ… Ø·Ø¨ÙŠØ¹ÙŠØ©", 3], ["ÙÙŠØ²ÙŠØ§Ø¡", 3], ["Ø¹Ø±Ø¨ÙŠØ©", 2], ["ÙØ±Ù†Ø³ÙŠØ©", 2], ["Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©", 2], ["ØªØ§Ø±ÙŠØ® ÙˆØ¬ØºØ±Ø§ÙÙŠØ§", 2], ["ØªØ±Ø¨ÙŠØ© Ø¥Ø³Ù„Ø§Ù…ÙŠØ©", 2], ["ÙÙ„Ø³ÙØ©", 2], ["ØªØ±Ø¨ÙŠØ© Ø¨Ø¯Ù†ÙŠØ©", 1]],
                "Ø±ÙŠØ§Ø¶ÙŠØ§Øª": [["Ø±ÙŠØ§Ø¶ÙŠØ§Øª", 5], ["ÙÙŠØ²ÙŠØ§Ø¡", 4], ["Ø¹Ù„ÙˆÙ… Ø·Ø¨ÙŠØ¹ÙŠØ©", 2], ["Ø¹Ø±Ø¨ÙŠØ©", 2], ["ÙØ±Ù†Ø³ÙŠØ©", 2], ["Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©", 2], ["ØªØ§Ø±ÙŠØ® ÙˆØ¬ØºØ±Ø§ÙÙŠØ§", 2], ["ØªØ±Ø¨ÙŠØ© Ø¥Ø³Ù„Ø§Ù…ÙŠØ©", 2], ["ÙÙ„Ø³ÙØ©", 2], ["ØªØ±Ø¨ÙŠØ© Ø¨Ø¯Ù†ÙŠØ©", 1]],
                "ØªÙ‚Ù†ÙŠ Ø±ÙŠØ§Ø¶ÙŠ": [["Ø±ÙŠØ§Ø¶ÙŠØ§Øª", 4], ["ÙÙŠØ²ÙŠØ§Ø¡", 4], ["ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§", 4], ["Ø¹Ø±Ø¨ÙŠØ©", 2], ["ÙØ±Ù†Ø³ÙŠØ©", 2], ["Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©", 2], ["ØªØ§Ø±ÙŠØ® ÙˆØ¬ØºØ±Ø§ÙÙŠØ§", 1], ["ØªØ±Ø¨ÙŠØ© Ø¥Ø³Ù„Ø§Ù…ÙŠØ©", 2], ["ÙÙ„Ø³ÙØ©", 2], ["ØªØ±Ø¨ÙŠØ© Ø¨Ø¯Ù†ÙŠØ©", 1]],
                "ØªØ³ÙŠÙŠØ± ÙˆØ§Ù‚ØªØµØ§Ø¯": [["Ø±ÙŠØ§Ø¶ÙŠØ§Øª", 3], ["Ø§Ù‚ØªØµØ§Ø¯ ÙˆØªØ³ÙŠÙŠØ±", 4], ["Ù‚Ø§Ù†ÙˆÙ†", 2], ["Ø¹Ø±Ø¨ÙŠØ©", 2], ["ÙØ±Ù†Ø³ÙŠØ©", 2], ["Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©", 2], ["ØªØ§Ø±ÙŠØ® ÙˆØ¬ØºØ±Ø§ÙÙŠØ§", 2], ["ØªØ±Ø¨ÙŠØ© Ø¥Ø³Ù„Ø§Ù…ÙŠØ©", 2], ["ÙÙ„Ø³ÙØ©", 2], ["ØªØ±Ø¨ÙŠØ© Ø¨Ø¯Ù†ÙŠØ©", 1]],
                "Ø¢Ø¯Ø§Ø¨ ÙˆÙÙ„Ø³ÙØ©": [["ÙÙ„Ø³ÙØ©", 4], ["Ø¹Ø±Ø¨ÙŠØ©", 4], ["ØªØ§Ø±ÙŠØ® ÙˆØ¬ØºØ±Ø§ÙÙŠØ§", 3], ["ÙØ±Ù†Ø³ÙŠØ©", 2], ["Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©", 2], ["ØªØ±Ø¨ÙŠØ© Ø¥Ø³Ù„Ø§Ù…ÙŠØ©", 2], ["Ø±ÙŠØ§Ø¶ÙŠØ§Øª", 2], ["Ø¹Ù„ÙˆÙ… Ø·Ø¨ÙŠØ¹ÙŠØ©", 1], ["ØªØ±Ø¨ÙŠØ© Ø¨Ø¯Ù†ÙŠØ©", 1]],
                "Ù„ØºØ§Øª": [["ÙØ±Ù†Ø³ÙŠØ©", 4], ["Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©", 3], ["Ø¹Ø±Ø¨ÙŠØ©", 3], ["Ø¥Ø³Ø¨Ø§Ù†ÙŠØ©", 2], ["ØªØ§Ø±ÙŠØ® ÙˆØ¬ØºØ±Ø§ÙÙŠØ§", 2], ["ØªØ±Ø¨ÙŠØ© Ø¥Ø³Ù„Ø§Ù…ÙŠØ©", 2], ["ÙÙ„Ø³ÙØ©", 2], ["Ø±ÙŠØ§Ø¶ÙŠØ§Øª", 2], ["ØªØ±Ø¨ÙŠØ© Ø¨Ø¯Ù†ÙŠØ©", 1]]
            },
            "3": {
                "Ø¹Ù„ÙˆÙ… ØªØ¬Ø±ÙŠØ¨ÙŠØ©": [["Ø±ÙŠØ§Ø¶ÙŠØ§Øª", 4], ["Ø¹Ù„ÙˆÙ… Ø·Ø¨ÙŠØ¹ÙŠØ©", 5], ["ÙÙŠØ²ÙŠØ§Ø¡", 4], ["Ø¹Ø±Ø¨ÙŠØ©", 2], ["ÙØ±Ù†Ø³ÙŠØ©", 2], ["Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©", 2], ["ØªØ§Ø±ÙŠØ® ÙˆØ¬ØºØ±Ø§ÙÙŠØ§", 2], ["ØªØ±Ø¨ÙŠØ© Ø¥Ø³Ù„Ø§Ù…ÙŠØ©", 2], ["ÙÙ„Ø³ÙØ©", 2], ["ØªØ±Ø¨ÙŠØ© Ø¨Ø¯Ù†ÙŠØ©", 1], ["ØªØ±Ø¨ÙŠØ© ÙÙ†ÙŠØ©", 1]],
                "Ø±ÙŠØ§Ø¶ÙŠØ§Øª": [["Ø±ÙŠØ§Ø¶ÙŠØ§Øª", 7], ["ÙÙŠØ²ÙŠØ§Ø¡", 6], ["Ø¹Ù„ÙˆÙ… Ø·Ø¨ÙŠØ¹ÙŠØ©", 2], ["Ø¹Ø±Ø¨ÙŠØ©", 2], ["ÙØ±Ù†Ø³ÙŠØ©", 2], ["Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©", 2], ["ØªØ§Ø±ÙŠØ® ÙˆØ¬ØºØ±Ø§ÙÙŠØ§", 2], ["ØªØ±Ø¨ÙŠØ© Ø¥Ø³Ù„Ø§Ù…ÙŠØ©", 2], ["ÙÙ„Ø³ÙØ©", 2], ["ØªØ±Ø¨ÙŠØ© Ø¨Ø¯Ù†ÙŠØ©", 1], ["ØªØ±Ø¨ÙŠØ© ÙÙ†ÙŠØ©", 1]],
                "ØªÙ‚Ù†ÙŠ Ø±ÙŠØ§Ø¶ÙŠ": [["Ø±ÙŠØ§Ø¶ÙŠØ§Øª", 5], ["ÙÙŠØ²ÙŠØ§Ø¡", 5], ["ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§", 5], ["Ø¹Ø±Ø¨ÙŠØ©", 2], ["ÙØ±Ù†Ø³ÙŠØ©", 2], ["Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©", 2], ["ØªØ§Ø±ÙŠØ® ÙˆØ¬ØºØ±Ø§ÙÙŠØ§", 1], ["ØªØ±Ø¨ÙŠØ© Ø¥Ø³Ù„Ø§Ù…ÙŠØ©", 2], ["ÙÙ„Ø³ÙØ©", 2], ["ØªØ±Ø¨ÙŠØ© Ø¨Ø¯Ù†ÙŠØ©", 1], ["ØªØ±Ø¨ÙŠØ© ÙÙ†ÙŠØ©", 1]],
                "ØªØ³ÙŠÙŠØ± ÙˆØ§Ù‚ØªØµØ§Ø¯": [["Ø±ÙŠØ§Ø¶ÙŠØ§Øª", 3], ["Ø§Ù‚ØªØµØ§Ø¯ ÙˆØªØ³ÙŠÙŠØ±", 5], ["Ù‚Ø§Ù†ÙˆÙ†", 3], ["Ø¹Ø±Ø¨ÙŠØ©", 2], ["ÙØ±Ù†Ø³ÙŠØ©", 2], ["Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©", 2], ["ØªØ§Ø±ÙŠØ® ÙˆØ¬ØºØ±Ø§ÙÙŠØ§", 2], ["ØªØ±Ø¨ÙŠØ© Ø¥Ø³Ù„Ø§Ù…ÙŠØ©", 2], ["ÙÙ„Ø³ÙØ©", 2], ["ØªØ±Ø¨ÙŠØ© Ø¨Ø¯Ù†ÙŠØ©", 1], ["ØªØ±Ø¨ÙŠØ© ÙÙ†ÙŠØ©", 1]],
                "Ø¢Ø¯Ø§Ø¨ ÙˆÙÙ„Ø³ÙØ©": [["ÙÙ„Ø³ÙØ©", 7], ["Ø¹Ø±Ø¨ÙŠØ©", 5], ["ØªØ§Ø±ÙŠØ® ÙˆØ¬ØºØ±Ø§ÙÙŠØ§", 4], ["ÙØ±Ù†Ø³ÙŠØ©", 3], ["Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©", 2], ["ØªØ±Ø¨ÙŠØ© Ø¥Ø³Ù„Ø§Ù…ÙŠØ©", 2], ["Ø±ÙŠØ§Ø¶ÙŠØ§Øª", 2], ["Ø¹Ù„ÙˆÙ… Ø·Ø¨ÙŠØ¹ÙŠØ©", 1], ["ØªØ±Ø¨ÙŠØ© Ø¨Ø¯Ù†ÙŠØ©", 1], ["ØªØ±Ø¨ÙŠØ© ÙÙ†ÙŠØ©", 1]],
                "Ù„ØºØ§Øª Ø£Ø¬Ù†Ø¨ÙŠØ©": [["ÙØ±Ù†Ø³ÙŠØ©", 5], ["Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©", 4], ["Ø¹Ø±Ø¨ÙŠØ©", 3], ["Ø¥Ø³Ø¨Ø§Ù†ÙŠØ©", 3], ["ØªØ§Ø±ÙŠØ® ÙˆØ¬ØºØ±Ø§ÙÙŠØ§", 2], ["ØªØ±Ø¨ÙŠØ© Ø¥Ø³Ù„Ø§Ù…ÙŠØ©", 2], ["ÙÙ„Ø³ÙØ©", 2], ["Ø±ÙŠØ§Ø¶ÙŠØ§Øª", 2], ["ØªØ±Ø¨ÙŠØ© Ø¨Ø¯Ù†ÙŠØ©", 1], ["ØªØ±Ø¨ÙŠØ© ÙÙ†ÙŠØ©", 1]]
            }
        };

        function loadStreams() {
            const y = document.getElementById('year-sel').value;
            const s = document.getElementById('stream-sel');
            s.innerHTML = "";
            for (let x in db[y]) s.innerHTML += `<option value="${x}">${x}</option>`;
            loadGPATable();
        }

        function loadGPATable() {
            const y = document.getElementById('year-sel').value;
            const st = document.getElementById('stream-sel').value;
            let h = "";
            let subs = [...db[y][st]];
            if(document.getElementById('tam-chk').checked) subs.push(["Ø£Ù…Ø§Ø²ÙŠØºÙŠØ©", 2]);
            
            subs.forEach(s => {
                h += `<tr data-c="${s[1]}">
                    <td><strong>${s[0]}</strong></td>
                    <td data-label="ØªÙ‚ÙˆÙŠÙ…"><input type="number" min="0" max="20" step="0.25" placeholder="0" oninput="autoSave()"></td>
                    <td data-label="ÙØ±Ø¶ 1"><input type="number" min="0" max="20" step="0.25" placeholder="0" oninput="autoSave()"></td>
                    <td data-label="ÙØ±Ø¶ 2"><input type="number" min="0" max="20" step="0.25" placeholder="0" oninput="autoSave()"></td>
                    <td data-label="Ø§Ø®ØªØ¨Ø§Ø±"><input type="number" min="0" max="20" step="0.25" placeholder="0" oninput="autoSave()"></td>
                    <td data-label="Ø§Ù„Ù…Ø¹Ø§Ù…Ù„"><strong>${s[1]}</strong></td>
                    <td data-label="Ø§Ù„Ù…Ø¹Ø¯Ù„" class="rt"><strong>0.00</strong></td>
                </tr>`;
            });
            document.getElementById('gpa-body').innerHTML = h;
            document.getElementById('final-res').classList.remove('show');
            restoreData();
        }

        function resetForm() {
            document.querySelectorAll("#gpa-body input").forEach(i => i.value = '');
            document.querySelectorAll(".rt").forEach(r => r.innerHTML = '<strong>0.00</strong>');
            document.getElementById('final-res').classList.remove('show');
            localStorage.removeItem('hmd_bac_saved_data');
            showSuccessMessage('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ù†Ø¬Ø§Ø­');
        }

        function getMotivationalMessage(avg) {
            if (avg >= 18) return { icon: 'ğŸ†', msg: 'Ù…Ù…ØªØ§Ø² Ø¬Ø¯Ø§Ù‹! Ø£Ù†Øª Ù…ØªÙÙˆÙ‚!', class: 'excellent' };
            if (avg >= 16) return { icon: 'ğŸŒŸ', msg: 'Ù…Ù…ØªØ§Ø²! Ø§Ø³ØªÙ…Ø± Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø±Ø§Ø¦Ø¹!', class: 'excellent' };
            if (avg >= 14) return { icon: 'ğŸ‘', msg: 'Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹! Ø£Ù†Øª Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø§Ù„ØµØ­ÙŠØ­!', class: 'good' };
            if (avg >= 12) return { icon: 'ğŸ‘', msg: 'Ø¬ÙŠØ¯! Ø­Ø§ÙˆÙ„ ØªØ­Ø³ÙŠÙ† Ø£Ø¯Ø§Ø¦Ùƒ!', class: 'good' };
            if (avg >= 10) return { icon: 'ğŸ’ª', msg: 'Ù…Ù‚Ø¨ÙˆÙ„ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø£ÙØ¶Ù„!', class: 'average' };
            return { icon: 'ğŸ“š', msg: 'ÙŠØ¬Ø¨ Ø¨Ø°Ù„ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¬Ù‡Ø¯! Ù„Ø§ ØªØ³ØªØ³Ù„Ù…!', class: 'weak' };
        }

        function calcGPA() {
            let tP = 0, tC = 0;
            document.querySelectorAll("#gpa-body tr").forEach(r => {
                const ins = r.querySelectorAll('input'), c = parseFloat(r.dataset.c);
                let eval = parseFloat(ins[0].value) || 0;
                let f1 = parseFloat(ins[1].value) || 0;
                let f2 = parseFloat(ins[2].value) || 0;
                let exam = parseFloat(ins[3].value) || 0;
                
                let divisor = (f2 > 0) ? 5 : 4;
                let subAvg = (eval + f1 + f2 + (exam * 2)) / divisor;
                
                r.querySelector('.rt').innerHTML = `<strong>${subAvg.toFixed(2)}</strong>`;
                tP += subAvg * c; tC += c;
            });
            const finalAvg = (tP/tC).toFixed(2);
            const resEl = document.getElementById('final-res');
            const msg = getMotivationalMessage(parseFloat(finalAvg));
            
            resEl.className = 'result-box show ' + msg.class;
            resEl.querySelector('.result-icon').textContent = msg.icon;
            resEl.querySelector('.result-text').textContent = `Ù…Ø¹Ø¯Ù„Ùƒ Ù‡Ùˆ: ${finalAvg}`;
            resEl.querySelector('.result-message').textContent = msg.msg;
        }

        // Yearly Average
        function calcYearly() {
            const t1 = parseFloat(document.getElementById('t1-avg').value) || 0;
            const t2 = parseFloat(document.getElementById('t2-avg').value) || 0;
            const t3 = parseFloat(document.getElementById('t3-avg').value) || 0;
            
            if(t1 === 0 || t2 === 0 || t3 === 0) {
                showSuccessMessage('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø¯Ù„Ø§Øª Ø§Ù„ÙØµÙˆÙ„ Ø§Ù„Ø«Ù„Ø§Ø«Ø©!');
                return;
            }
            
            const yearlyAvg = ((t1 + t2 + t3) / 3).toFixed(2);
            const resEl = document.getElementById('yearly-result');
            const msg = getMotivationalMessage(parseFloat(yearlyAvg));
            
            resEl.className = 'result-box show ' + msg.class;
            resEl.querySelector('.result-icon').textContent = msg.icon;
            resEl.querySelector('.result-text').textContent = `Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ: ${yearlyAvg}`;
            resEl.querySelector('.result-message').textContent = msg.msg;
        }

        // Calculate Needed Mark
        function calcNeeded() {
            const targetAvg = parseFloat(document.getElementById('target-avg').value);
            const evalMark = parseFloat(document.getElementById('eval-mark').value) || 0;
            const test1 = parseFloat(document.getElementById('test1-mark').value) || 0;
            const test2 = parseFloat(document.getElementById('test2-mark').value) || 0;
            
            if(!targetAvg) {
                showSuccessMessage('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨!');
                return;
            }
            
            const divisor = (test2 > 0) ? 5 : 4;
            const neededExam = ((targetAvg * divisor) - evalMark - test1 - test2) / 2;
            
            const resEl = document.getElementById('needed-result');
            
            if(neededExam > 20) {
                resEl.className = 'result-box show weak';
                resEl.querySelector('.result-icon').textContent = 'âš ï¸';
                resEl.querySelector('.result-text').textContent = `Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: ${neededExam.toFixed(2)}`;
                resEl.querySelector('.result-message').textContent = 'Ù„Ù„Ø£Ø³ÙØŒ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ­ÙŠÙ„ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ù…Ø¹ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©!';
            } else if(neededExam < 0) {
                resEl.className = 'result-box show excellent';
                resEl.querySelector('.result-icon').textContent = 'ğŸ‰';
                resEl.querySelector('.result-text').textContent = `Ø£Ù†Øª Ù…ØªÙÙˆÙ‚!`;
                resEl.querySelector('.result-message').textContent = 'Ù„Ù‚Ø¯ Ø­Ù‚Ù‚Øª Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¨Ø§Ù„ÙØ¹Ù„!';
            } else {
                const msgClass = neededExam <= 10 ? 'excellent' : neededExam <= 15 ? 'good' : 'average';
                resEl.className = 'result-box show ' + msgClass;
                resEl.querySelector('.result-icon').textContent = 'ğŸ¯';
                resEl.querySelector('.result-text').textContent = `Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ${neededExam.toFixed(2)}`;
                resEl.querySelector('.result-message').textContent = neededExam <= 10 ? 'Ø³Ù‡Ù„ Ø¬Ø¯Ø§Ù‹! ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ù‚ÙŠÙ‚Ù‡!' : neededExam <= 15 ? 'Ù…Ù…ÙƒÙ†! Ø§Ø¬ØªÙ‡Ø¯ Ù‚Ù„ÙŠÙ„Ø§Ù‹!' : 'ÙŠØªØ·Ù„Ø¨ Ø¬Ù‡Ø¯Ø§Ù‹ ÙƒØ¨ÙŠØ±Ø§Ù‹ØŒ Ù„ÙƒÙ†Ù‡ Ù…Ù…ÙƒÙ†!';
            }
        }

        // BAC Functions
        function loadBacStreams() {
            const s = document.getElementById('bac-strm');
            s.innerHTML = "";
            for (let x in db["3"]) s.innerHTML += `<option value="${x}">${x}</option>`;
            loadBacTable();
        }

        function loadBacTable() {
            const st = document.getElementById('bac-strm').value;
            let h = "";
            let subs = [...db["3"][st]];
            if(document.getElementById('tam-bac').checked) subs.push(["Ø£Ù…Ø§Ø²ÙŠØºÙŠØ©", 2]);
            
            subs.forEach(s => {
                h += `<tr data-c="${s[1]}">
                    <td><strong>${s[0]}</strong></td>
                    <td data-label="Ø§Ù„Ø¹Ù„Ø§Ù…Ø©"><input type="number" min="0" max="20" step="0.25" placeholder="0"></td>
                    <td data-label="Ø§Ù„Ù…Ø¹Ø§Ù…Ù„"><strong>${s[1]}</strong></td>
                    <td data-label="Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹" class="b-sum"><strong>0.00</strong></td>
                </tr>`;
            });
            document.getElementById('bac-body').innerHTML = h;
            document.getElementById('bac-stats').classList.remove('show');
        }

        function calcBac() {
            let tP = 0, tC = 0;
            document.querySelectorAll("#bac-body tr").forEach(r => {
                let v = parseFloat(r.querySelector('input').value)||0, c = parseFloat(r.dataset.c);
                let name = r.cells[0].innerText;
                if (name === "Ø£Ù…Ø§Ø²ÙŠØºÙŠØ©" || name === "ØªØ±Ø¨ÙŠØ© ÙÙ†ÙŠØ©") {
                    let extra = v > 10 ? (v - 10) : 0;
                    r.querySelector('.b-sum').innerHTML = `<strong>+${extra.toFixed(2)}</strong>`;
                    tP += extra;
                } else {
                    r.querySelector('.b-sum').innerHTML = `<strong>${(v * c).toFixed(2)}</strong>`;
                    tP += v * c; tC += c;
                }
            });
            document.getElementById('res-pts').textContent = tP.toFixed(2);
            document.getElementById('res-coef').textContent = tC;
            document.getElementById('res-avg').textContent = (tP/tC).toFixed(2);
            document.getElementById('bac-stats').classList.add('show');
        }

        // Storage Functions
        function autoSave() {
            saveData(true);
        }
        
        function saveData(silent = false) {
            const vals = [];
            document.querySelectorAll("#gpa-body input").forEach(i => vals.push(i.value));
            localStorage.setItem('hmd_bac_saved_data', JSON.stringify(vals));
            
            if(!silent) {
                showSuccessMessage('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! âœ“');
            }
        }

        function restoreData() {
            const savedData = localStorage.getItem('hmd_bac_saved_data');
            const vals = savedData ? JSON.parse(savedData) : null;
            if(vals) {
                document.querySelectorAll("#gpa-body input").forEach((i, idx) => {
                    if(vals[idx] !== undefined) i.value = vals[idx];
                });
            }
        }

        // Capture Result as Image
        function captureResult() {
            const resultEl = document.getElementById('final-res');
            if(!resultEl.classList.contains('show')) {
                showSuccessMessage('âš ï¸ Ù‚Ù… Ø¨Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø£ÙˆÙ„Ø§Ù‹!');
                return;
            }
            
            html2canvas(resultEl, {
                backgroundColor: null,
                scale: 2
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'Ù…Ø¹Ø¯Ù„ÙŠ-HMD.png';
                link.href = canvas.toDataURL();
                link.click();
                showSuccessMessage('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­! ğŸ“¸');
            });
        }

        // UI Functions
        function switchTab(index) {
            document.querySelectorAll('.tab').forEach((t, i) => {
                t.classList.toggle('active', i === index);
            });
            document.querySelectorAll('.panel').forEach((p, i) => {
                p.classList.toggle('active', i === index);
            });
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const icon = document.querySelector('.theme-toggle i');
            icon.className = document.body.classList.contains('dark-mode') ? 'fas fa-sun' : 'fas fa-moon';
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        }

        function showSuccessMessage(msg) {
            const el = document.getElementById('successMsg');
            el.textContent = msg;
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 3000);
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            loadStreams();
            loadBacStreams();
            
            // Load theme
            if(localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-mode');
                document.querySelector('.theme-toggle i').className = 'fas fa-sun';
            }
        });
    </script>
</body>
</html>
